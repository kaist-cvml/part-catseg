# Copyright (c) Facebook, Inc. and its affiliates.
import logging
import os
from detectron2.data import DatasetCatalog, MetadataCatalog
# from detectron2.data.datasets.register_coco import register_coco_instances
from detectron2.data.datasets.coco import load_coco_json

OBJ_CLASS_NAMES = [
    'mountain bike',
    'gazelle',
    'macaque',
    'bee eater',
    'racer',
    'hartebeest',
    'green snake',
    'gorilla',
    'chow',
    'patas',
    'goldfish',
    'thunder snake',
    'English springer',
    'Egyptian cat',
    'kite',
    'loggerhead',
    'minivan',
    'Saluki',
    'Eskimo dog',
    'agama',
    'anemone fish',
    'polecat',
    'coho',
    'guenon',
    'spider monkey',
    'timber wolf',
    'frilled lizard',
    'tiger',
    'Irish water spaniel',
    'bighorn',
    'tricycle',
    'proboscis monkey',
    'African chameleon',
    'ambulance',
    'warthog',
    'vizsla',
    'police van',
    'Tibetan terrier',
    'green mamba',
    'sidewinder',
    'tractor',
    'horned viper',
    'American black bear',
    'pirate',
    'rock python',
    'tailed frog',
    'fox squirrel',
    'cairn',
    'redbone',
    'American egret',
    'water buffalo',
    'leatherback turtle',
    'green lizard',
    'Walker hound',
    'garter snake',
    'golfcart',
    'box turtle',
    'ox',
    'go-kart',
    'beer bottle',
    'convertible',
    'howler monkey',
    'cheetah',
    'ruddy turnstone',
    'school bus',
    'pill bottle',
    'yawl',
    'weasel',
    'killer whale',
    'Arabian camel',
    'chimpanzee',
    'airliner',
    'baboon',
    'spotted salamander',
    'motor scooter',
    'recreational vehicle',
    'Brittany spaniel',
    'dowitcher',
    'capuchin',
    'American alligator',
    'leopard',
    'hognose snake',
    'gibbon',
    'minibus',
    'limousine',
    'colobus',
    'Gila monster',
    'night snake',
    'boa constrictor',
    'otter',
    'diamondback',
    'Boston bull',
    'common newt',
    'bullfrog',
    'tench',
    'black stork',
    'vine snake',
    'brown bear',
    'soft-coated wheaten terrier',
    'spoonbill',
    'impala',
    'albatross',
    'giant panda',
    'snowplow',
    'garbage truck',
    'ram',
    'Komodo dragon',
    'pop bottle',
    'goose',
    'ice bear',
    'barracouta',
    'Saint Bernard',
    'Indian cobra',
    'golden retriever',
    'cab',
    'unicycle',
    'trimaran',
    'siamang',
    'little blue heron',
    'marmoset',
    'mink',
    'whiptail',
    'great white shark',
    'alligator lizard',
    'bald eagle',
    'cougar',
    'beach wagon',
    'water bottle'
 ]

OBJ_NOVEL_CLASS_NAMES = [
    'ice bear',
    'barracouta',
    'Saint Bernard',
    'Indian cobra',
    'golden retriever',
    'cab',
    'unicycle',
    'trimaran',
    'siamang',
    'little blue heron',
    'marmoset',
    'mink',
    'whiptail',
    'great white shark',
    'alligator lizard',
    'bald eagle',
    'cougar',
    'beach wagon',
    'water bottle'
]

OBJ_BASE_CLASS_NAMES = [c for c in OBJ_CLASS_NAMES if c not in OBJ_NOVEL_CLASS_NAMES]

CLASS_NAMES = [
    "impala's head",
    "impala's body",
    "impala's foot",
    "impala's tail",
    "night snake's head",
    "night snake's body",
    "Gila monster's head",
    "Gila monster's body",
    "Gila monster's foot",
    "Gila monster's tail",
    "trimaran's body",
    "trimaran's sail",
    "barracouta's head",
    "barracouta's body",
    "barracouta's fin",
    "barracouta's tail",
    "albatross's head",
    "albatross's body",
    "albatross's wing",
    "albatross's foot",
    "albatross's tail",
    "garbage truck's body",
    "garbage truck's tier",
    "garbage truck's side mirror",
    "beach wagon's body",
    "beach wagon's tier",
    "beach wagon's side mirror",
    "Egyptian cat's head",
    "Egyptian cat's body",
    "Egyptian cat's foot",
    "Egyptian cat's tail",
    "warthog's head",
    "warthog's body",
    "warthog's foot",
    "warthog's tail",
    "minibus's body",
    "minibus's tier",
    "minibus's side mirror",
    "unicycle's body",
    "unicycle's head",
    "unicycle's seat",
    "unicycle's tier",
    "little blue heron's head",
    "little blue heron's body",
    "little blue heron's wing",
    "little blue heron's foot",
    "little blue heron's tail",
    "otter's head",
    "otter's body",
    "otter's foot",
    "otter's tail",
    "goldfish's head",
    "goldfish's body",
    "goldfish's fin",
    "goldfish's tail",
    "gorilla's head",
    "gorilla's body",
    "gorilla's hand",
    "gorilla's foot",
    "gorilla's tail",
    "Tibetan terrier's head",
    "Tibetan terrier's body",
    "Tibetan terrier's foot",
    "Tibetan terrier's tail",
    "ambulance's body",
    "ambulance's tier",
    "ambulance's side mirror",
    "spoonbill's head",
    "spoonbill's body",
    "spoonbill's wing",
    "spoonbill's foot",
    "spoonbill's tail",
    "motor scooter's body",
    "motor scooter's head",
    "motor scooter's seat",
    "motor scooter's tier",
    "yawl's body",
    "yawl's sail",
    "snowplow's body",
    "snowplow's tier",
    "snowplow's side mirror",
    "timber wolf's head",
    "timber wolf's body",
    "timber wolf's foot",
    "timber wolf's tail",
    "common newt's head",
    "common newt's body",
    "common newt's foot",
    "common newt's tail",
    "polecat's head",
    "polecat's body",
    "polecat's foot",
    "polecat's tail",
    "gibbon's head",
    "gibbon's body",
    "gibbon's hand",
    "gibbon's foot",
    "gibbon's tail",
    "water buffalo's head",
    "water buffalo's body",
    "water buffalo's foot",
    "water buffalo's tail",
    "golfcart's body",
    "golfcart's tier",
    "golfcart's side mirror",
    "guenon's head",
    "guenon's body",
    "guenon's hand",
    "guenon's foot",
    "guenon's tail",
    "ox's head",
    "ox's body",
    "ox's foot",
    "ox's tail",
    "siamang's head",
    "siamang's body",
    "siamang's hand",
    "siamang's foot",
    "siamang's tail",
    "boa constrictor's head",
    "boa constrictor's body",
    "police van's body",
    "police van's tier",
    "police van's side mirror",
    "green lizard's head",
    "green lizard's body",
    "green lizard's foot",
    "green lizard's tail",
    "redbone's head",
    "redbone's body",
    "redbone's foot",
    "redbone's tail",
    "black stork's head",
    "black stork's body",
    "black stork's wing",
    "black stork's foot",
    "black stork's tail",
    "golden retriever's head",
    "golden retriever's body",
    "golden retriever's foot",
    "golden retriever's tail",
    "coho's head",
    "coho's body",
    "coho's fin",
    "coho's tail",
    "minivan's body",
    "minivan's tier",
    "minivan's side mirror",
    "green mamba's head",
    "green mamba's body",
    "English springer's head",
    "English springer's body",
    "English springer's foot",
    "English springer's tail",
    "macaque's head",
    "macaque's body",
    "macaque's hand",
    "macaque's foot",
    "macaque's tail",
    "patas's head",
    "patas's body",
    "patas's hand",
    "patas's foot",
    "patas's tail",
    "beer bottle's mouth",
    "beer bottle's body",
    "tiger's head",
    "tiger's body",
    "tiger's foot",
    "tiger's tail",
    "convertible's body",
    "convertible's tier",
    "convertible's side mirror",
    "dowitcher's head",
    "dowitcher's body",
    "dowitcher's wing",
    "dowitcher's foot",
    "dowitcher's tail",
    "howler monkey's head",
    "howler monkey's body",
    "howler monkey's hand",
    "howler monkey's foot",
    "howler monkey's tail",
    "pop bottle's mouth",
    "pop bottle's body",
    "American black bear's head",
    "American black bear's body",
    "American black bear's foot",
    "American black bear's tail",
    "thunder snake's head",
    "thunder snake's body",
    "leopard's head",
    "leopard's body",
    "leopard's foot",
    "leopard's tail",
    "hartebeest's head",
    "hartebeest's body",
    "hartebeest's foot",
    "hartebeest's tail",
    "chimpanzee's head",
    "chimpanzee's body",
    "chimpanzee's hand",
    "chimpanzee's foot",
    "chimpanzee's tail",
    "vizsla's head",
    "vizsla's body",
    "vizsla's foot",
    "vizsla's tail",
    "American egret's head",
    "American egret's body",
    "American egret's wing",
    "American egret's foot",
    "American egret's tail",
    "Brittany spaniel's head",
    "Brittany spaniel's body",
    "Brittany spaniel's foot",
    "Brittany spaniel's tail",
    "goose's head",
    "goose's body",
    "goose's wing",
    "goose's foot",
    "goose's tail",
    "water bottle's mouth",
    "water bottle's body",
    "proboscis monkey's head",
    "proboscis monkey's body",
    "proboscis monkey's hand",
    "proboscis monkey's foot",
    "proboscis monkey's tail",
    "green snake's head",
    "green snake's body",
    "limousine's body",
    "limousine's tier",
    "limousine's side mirror",
    "bullfrog's head",
    "bullfrog's body",
    "bullfrog's foot",
    "bullfrog's tail",
    "hognose snake's head",
    "hognose snake's body",
    "American alligator's head",
    "American alligator's body",
    "American alligator's foot",
    "American alligator's tail",
    "giant panda's head",
    "giant panda's body",
    "giant panda's foot",
    "giant panda's tail",
    "Boston bull's head",
    "Boston bull's body",
    "Boston bull's foot",
    "Boston bull's tail",
    "cougar's head",
    "cougar's body",
    "cougar's foot",
    "cougar's tail",
    "ram's head",
    "ram's body",
    "ram's foot",
    "ram's tail",
    "tench's head",
    "tench's body",
    "tench's fin",
    "tench's tail",
    "cairn's head",
    "cairn's body",
    "cairn's foot",
    "cairn's tail",
    "leatherback turtle's head",
    "leatherback turtle's body",
    "leatherback turtle's foot",
    "leatherback turtle's tail",
    "ruddy turnstone's head",
    "ruddy turnstone's body",
    "ruddy turnstone's wing",
    "ruddy turnstone's foot",
    "ruddy turnstone's tail",
    "Arabian camel's head",
    "Arabian camel's body",
    "Arabian camel's foot",
    "Arabian camel's tail",
    "ice bear's head",
    "ice bear's body",
    "ice bear's foot",
    "ice bear's tail",
    "anemone fish's head",
    "anemone fish's body",
    "anemone fish's fin",
    "anemone fish's tail",
    "fox squirrel's head",
    "fox squirrel's body",
    "fox squirrel's foot",
    "fox squirrel's tail",
    "pirate's body",
    "pirate's sail",
    "spotted salamander's head",
    "spotted salamander's body",
    "spotted salamander's foot",
    "spotted salamander's tail",
    "recreational vehicle's body",
    "recreational vehicle's tier",
    "recreational vehicle's side mirror",
    "sidewinder's head",
    "sidewinder's body",
    "box turtle's head",
    "box turtle's body",
    "box turtle's foot",
    "box turtle's tail",
    "Eskimo dog's head",
    "Eskimo dog's body",
    "Eskimo dog's foot",
    "Eskimo dog's tail",
    "Irish water spaniel's head",
    "Irish water spaniel's body",
    "Irish water spaniel's foot",
    "Irish water spaniel's tail",
    "tricycle's body",
    "tricycle's head",
    "tricycle's seat",
    "tricycle's tier",
    "tailed frog's head",
    "tailed frog's body",
    "tailed frog's foot",
    "tailed frog's tail",
    "African chameleon's head",
    "African chameleon's body",
    "African chameleon's foot",
    "African chameleon's tail",
    "spider monkey's head",
    "spider monkey's body",
    "spider monkey's hand",
    "spider monkey's foot",
    "spider monkey's tail",
    "go-kart's body",
    "go-kart's tier",
    "go-kart's side mirror",
    "Saluki's head",
    "Saluki's body",
    "Saluki's foot",
    "Saluki's tail",
    "baboon's head",
    "baboon's body",
    "baboon's hand",
    "baboon's foot",
    "baboon's tail",
    "cab's body",
    "cab's tier",
    "cab's side mirror",
    "Walker hound's head",
    "Walker hound's body",
    "Walker hound's foot",
    "Walker hound's tail",
    "tractor's body",
    "tractor's tier",
    "tractor's side mirror",
    "cheetah's head",
    "cheetah's body",
    "cheetah's foot",
    "cheetah's tail",
    "whiptail's head",
    "whiptail's body",
    "whiptail's foot",
    "whiptail's tail",
    "Komodo dragon's head",
    "Komodo dragon's body",
    "Komodo dragon's foot",
    "Komodo dragon's tail",
    "bee eater's head",
    "bee eater's body",
    "bee eater's wing",
    "bee eater's foot",
    "bee eater's tail",
    "Indian cobra's head",
    "Indian cobra's body",
    "kite's head",
    "kite's body",
    "kite's wing",
    "kite's foot",
    "kite's tail",
    "alligator lizard's head",
    "alligator lizard's body",
    "alligator lizard's foot",
    "alligator lizard's tail",
    "gazelle's head",
    "gazelle's body",
    "gazelle's foot",
    "gazelle's tail",
    "agama's head",
    "agama's body",
    "agama's foot",
    "agama's tail",
    "mink's head",
    "mink's body",
    "mink's foot",
    "mink's tail",
    "horned viper's head",
    "horned viper's body",
    "diamondback's head",
    "diamondback's body",
    "colobus's head",
    "colobus's body",
    "colobus's hand",
    "colobus's foot",
    "colobus's tail",
    "mountain bike's body",
    "mountain bike's head",
    "mountain bike's seat",
    "mountain bike's tier",
    "soft-coated wheaten terrier's head",
    "soft-coated wheaten terrier's body",
    "soft-coated wheaten terrier's foot",
    "soft-coated wheaten terrier's tail",
    "bighorn's head",
    "bighorn's body",
    "bighorn's foot",
    "bighorn's tail",
    "school bus's body",
    "school bus's tier",
    "school bus's side mirror",
    "rock python's head",
    "rock python's body",
    "capuchin's head",
    "capuchin's body",
    "capuchin's hand",
    "capuchin's foot",
    "capuchin's tail",
    "killer whale's head",
    "killer whale's body",
    "killer whale's fin",
    "killer whale's tail",
    "great white shark's head",
    "great white shark's body",
    "great white shark's fin",
    "great white shark's tail",
    "garter snake's head",
    "garter snake's body",
    "Saint Bernard's head",
    "Saint Bernard's body",
    "Saint Bernard's foot",
    "Saint Bernard's tail",
    "brown bear's head",
    "brown bear's body",
    "brown bear's foot",
    "brown bear's tail",
    "frilled lizard's head",
    "frilled lizard's body",
    "frilled lizard's foot",
    "frilled lizard's tail",
    "chow's head",
    "chow's body",
    "chow's foot",
    "chow's tail",
    "weasel's head",
    "weasel's body",
    "weasel's foot",
    "weasel's tail",
    "airliner's head",
    "airliner's body",
    "airliner's engine",
    "airliner's wing",
    "airliner's tail",
    "bald eagle's head",
    "bald eagle's body",
    "bald eagle's wing",
    "bald eagle's foot",
    "bald eagle's tail",
    "pill bottle's mouth",
    "pill bottle's body",
    "loggerhead's head",
    "loggerhead's body",
    "loggerhead's foot",
    "loggerhead's tail",
    "vine snake's head",
    "vine snake's body",
    "racer's body",
    "racer's tier",
    "racer's side mirror",
    "marmoset's head",
    "marmoset's body",
    "marmoset's hand",
    "marmoset's foot",
    "marmoset's tail"
 ]

BASE_CLASS_NAMES = [c for i, c in enumerate(CLASS_NAMES) if c.split('\'s', maxsplit=1)[0] not in OBJ_NOVEL_CLASS_NAMES]

PART_CLASS_NAMES = [
    'body',
    'engine',
    'fin',
    'foot',
    'hand',
    'head',
    'mouth',
    'sail',
    'seat',
    'side mirror',
    'tail',
    'tier',
    'wing'
]

PART_BASE_CLASS_NAMES = [
    'body',
    'engine',
    'fin',
    'foot',
    'hand',
    'head',
    'mouth',
    'sail',
    'seat',
    'side mirror',
    'tail',
    'tier',
    'wing'
]


PART_IN_CATEGORIES = [
    {'id': 0, 'name': 'Quadruped Head', 'supercategory': 'Quadruped'},
    {'id': 1, 'name': 'Quadruped Body', 'supercategory': 'Quadruped'},
    {'id': 2, 'name': 'Quadruped Foot', 'supercategory': 'Quadruped'},
    {'id': 3, 'name': 'Quadruped Tail', 'supercategory': 'Quadruped'},
    {'id': 4, 'name': 'Biped Head', 'supercategory': 'Biped'},
    {'id': 5, 'name': 'Biped Body', 'supercategory': 'Biped'},
    {'id': 6, 'name': 'Biped Hand', 'supercategory': 'Biped'},
    {'id': 7, 'name': 'Biped Foot', 'supercategory': 'Biped'},
    {'id': 8, 'name': 'Biped Tail', 'supercategory': 'Biped'},
    {'id': 9, 'name': 'Fish Head', 'supercategory': 'Fish'},
    {'id': 10, 'name': 'Fish Body', 'supercategory': 'Fish'},
    {'id': 11, 'name': 'Fish Fin', 'supercategory': 'Fish'},
    {'id': 12, 'name': 'Fish Tail', 'supercategory': 'Fish'},
    {'id': 13, 'name': 'Bird Head', 'supercategory': 'Bird'},
    {'id': 14, 'name': 'Bird Body', 'supercategory': 'Bird'},
    {'id': 15, 'name': 'Bird Wing', 'supercategory': 'Bird'},
    {'id': 16, 'name': 'Bird Foot', 'supercategory': 'Bird'},
    {'id': 17, 'name': 'Bird Tail', 'supercategory': 'Bird'},
    {'id': 18, 'name': 'Snake Head', 'supercategory': 'Snake'},
    {'id': 19, 'name': 'Snake Body', 'supercategory': 'Snake'},
    {'id': 20, 'name': 'Reptile Head', 'supercategory': 'Reptile'},
    {'id': 21, 'name': 'Reptile Body', 'supercategory': 'Reptile'},
    {'id': 22, 'name': 'Reptile Foot', 'supercategory': 'Reptile'},
    {'id': 23, 'name': 'Reptile Tail', 'supercategory': 'Reptile'},
    {'id': 24, 'name': 'Car Body', 'supercategory': 'Car'},
    {'id': 25, 'name': 'Car Tier', 'supercategory': 'Car'},
    {'id': 26, 'name': 'Car Side Mirror', 'supercategory': 'Car'},
    {'id': 27, 'name': 'Bicycle Body', 'supercategory': 'Bicycle'},
    {'id': 28, 'name': 'Bicycle Head', 'supercategory': 'Bicycle'},
    {'id': 29, 'name': 'Bicycle Seat', 'supercategory': 'Bicycle'},
    {'id': 30, 'name': 'Bicycle Tier', 'supercategory': 'Bicycle'},
    {'id': 31, 'name': 'Boat Body', 'supercategory': 'Boat'},
    {'id': 32, 'name': 'Boat Sail', 'supercategory': 'Boat'},
    {'id': 33, 'name': 'Aeroplane Head', 'supercategory': 'Aeroplane'},
    {'id': 34, 'name': 'Aeroplane Body', 'supercategory': 'Aeroplane'},
    {'id': 35, 'name': 'Aeroplane Engine', 'supercategory': 'Aeroplane'},
    {'id': 36, 'name': 'Aeroplane Wing', 'supercategory': 'Aeroplane'},
    {'id': 37, 'name': 'Aeroplane Tail', 'supercategory': 'Aeroplane'},
    {'id': 38, 'name': 'Bottle Mouth', 'supercategory': 'Bottle'},
    {'id': 39, 'name': 'Bottle Body', 'supercategory': 'Bottle'}
]


CLASS_COLORS = {"impala's head": [29, 196, 114], "impala's body": [253, 158, 121], "impala's foot": [246, 58, 75], "impala's tail": [29, 144, 195], "night snake's head": [18, 34, 235], "night snake's body": [124, 116, 101], "Gila monster's head": [177, 134, 196], "Gila monster's body": [34, 129, 132], "Gila monster's foot": [205, 168, 2], "Gila monster's tail": [81, 119, 102], "trimaran's body": [70, 156, 96], "trimaran's sail": [32, 110, 68], "barracouta's head": [173, 213, 35], "barracouta's body": [53, 171, 63], "barracouta's fin": [48, 214, 232], "barracouta's tail": [125, 151, 55], "albatross's head": [13, 19, 137], "albatross's body": [33, 48, 116], "albatross's wing": [18, 228, 217], "albatross's foot": [188, 139, 101], "albatross's tail": [86, 231, 188], "garbage truck's body": [29, 157, 247], "garbage truck's tier": [101, 65, 62], "garbage truck's side mirror": [207, 153, 113], "beach wagon's body": [231, 211, 14], "beach wagon's tier": [236, 139, 52], "beach wagon's side mirror": [79, 59, 9], "Egyptian cat's head": [177, 155, 127], "Egyptian cat's body": [98, 187, 222], "Egyptian cat's foot": [249, 234, 233], "Egyptian cat's tail": [70, 223, 243], "warthog's head": [210, 145, 108], "warthog's body": [20, 234, 200], "warthog's foot": [197, 37, 54], "warthog's tail": [24, 46, 22], "minibus's body": [131, 10, 168], "minibus's tier": [131, 135, 122], "minibus's side mirror": [238, 98, 0], "unicycle's body": [116, 135, 136], "unicycle's head": [137, 61, 81], "unicycle's seat": [63, 79, 173], "unicycle's tier": [220, 244, 242], "little blue heron's head": [201, 147, 196], "little blue heron's body": [92, 15, 37], "little blue heron's wing": [19, 33, 4], "little blue heron's foot": [111, 245, 10], "little blue heron's tail": [133, 74, 253], "otter's head": [96, 140, 114], "otter's body": [66, 189, 42], "otter's foot": [239, 100, 8], "otter's tail": [87, 243, 178], "goldfish's head": [15, 15, 124], "goldfish's body": [101, 52, 14], "goldfish's fin": [147, 120, 55], "goldfish's tail": [99, 74, 225], "gorilla's head": [4, 195, 183], "gorilla's body": [29, 37, 38], "gorilla's hand": [31, 175, 163], "gorilla's foot": [139, 21, 152], "gorilla's tail": [245, 147, 189], "Tibetan terrier's head": [159, 73, 144], "Tibetan terrier's body": [8, 103, 26], "Tibetan terrier's foot": [11, 146, 131], "Tibetan terrier's tail": [229, 231, 220], "ambulance's body": [186, 240, 5], "ambulance's tier": [233, 201, 204], "ambulance's side mirror": [25, 222, 60], "spoonbill's head": [94, 102, 101], "spoonbill's body": [8, 246, 40], "spoonbill's wing": [221, 119, 224], "spoonbill's foot": [215, 219, 135], "spoonbill's tail": [236, 183, 85], "motor scooter's body": [233, 131, 55], "motor scooter's head": [21, 100, 43], "motor scooter's seat": [246, 24, 123], "motor scooter's tier": [231, 111, 197], "yawl's body": [115, 131, 1], "yawl's sail": [244, 120, 207], "snowplow's body": [43, 110, 48], "snowplow's tier": [47, 102, 239], "snowplow's side mirror": [112, 176, 158], "timber wolf's head": [70, 98, 208], "timber wolf's body": [191, 110, 48], "timber wolf's foot": [245, 160, 153], "timber wolf's tail": [177, 74, 194], "common newt's head": [251, 35, 215], "common newt's body": [82, 172, 43], "common newt's foot": [215, 166, 142], "common newt's tail": [88, 255, 96], "polecat's head": [42, 53, 142], "polecat's body": [110, 224, 85], "polecat's foot": [9, 7, 251], "polecat's tail": [176, 221, 161], "gibbon's head": [58, 201, 138], "gibbon's body": [53, 236, 67], "gibbon's hand": [226, 102, 115], "gibbon's foot": [162, 117, 149], "gibbon's tail": [219, 56, 1], "water buffalo's head": [74, 223, 112], "water buffalo's body": [179, 225, 241], "water buffalo's foot": [228, 221, 28], "water buffalo's tail": [163, 123, 83], "golfcart's body": [241, 109, 14], "golfcart's tier": [246, 45, 10], "golfcart's side mirror": [99, 95, 134], "guenon's head": [152, 183, 141], "guenon's body": [59, 224, 164], "guenon's hand": [56, 171, 120], "guenon's foot": [138, 249, 35], "guenon's tail": [41, 6, 78], "ox's head": [28, 251, 223], "ox's body": [129, 72, 184], "ox's foot": [132, 105, 208], "ox's tail": [101, 97, 63], "siamang's head": [71, 155, 163], "siamang's body": [89, 243, 158], "siamang's hand": [223, 169, 200], "siamang's foot": [70, 201, 215], "siamang's tail": [253, 146, 196], "boa constrictor's head": [181, 128, 42], "boa constrictor's body": [203, 58, 178], "police van's body": [1, 106, 175], "police van's tier": [96, 118, 238], "police van's side mirror": [42, 227, 218], "green lizard's head": [246, 221, 102], "green lizard's body": [194, 211, 185], "green lizard's foot": [246, 207, 182], "green lizard's tail": [140, 151, 141], "redbone's head": [157, 12, 125], "redbone's body": [255, 74, 174], "redbone's foot": [240, 154, 218], "redbone's tail": [7, 18, 251], "black stork's head": [30, 229, 212], "black stork's body": [11, 50, 155], "black stork's wing": [66, 180, 200], "black stork's foot": [129, 137, 244], "black stork's tail": [188, 222, 126], "golden retriever's head": [145, 0, 153], "golden retriever's body": [119, 4, 123], "golden retriever's foot": [167, 211, 190], "golden retriever's tail": [19, 30, 200], "coho's head": [109, 134, 41], "coho's body": [73, 145, 184], "coho's fin": [110, 183, 107], "coho's tail": [138, 231, 27], "minivan's body": [33, 129, 224], "minivan's tier": [130, 155, 231], "minivan's side mirror": [55, 182, 115], "green mamba's head": [78, 149, 29], "green mamba's body": [17, 140, 32], "English springer's head": [7, 99, 176], "English springer's body": [69, 162, 223], "English springer's foot": [231, 144, 133], "English springer's tail": [236, 73, 238], "macaque's head": [37, 38, 60], "macaque's body": [114, 103, 175], "macaque's hand": [104, 253, 111], "macaque's foot": [3, 152, 161], "macaque's tail": [41, 9, 17], "patas's head": [92, 237, 209], "patas's body": [164, 9, 61], "patas's hand": [248, 11, 230], "patas's foot": [57, 189, 45], "patas's tail": [197, 169, 29], "beer bottle's mouth": [125, 116, 118], "beer bottle's body": [131, 251, 24], "tiger's head": [178, 192, 131], "tiger's body": [242, 246, 85], "tiger's foot": [40, 4, 98], "tiger's tail": [182, 241, 148], "convertible's body": [146, 204, 78], "convertible's tier": [221, 58, 63], "convertible's side mirror": [219, 149, 127], "dowitcher's head": [208, 251, 40], "dowitcher's body": [57, 151, 84], "dowitcher's wing": [38, 25, 171], "dowitcher's foot": [153, 204, 3], "dowitcher's tail": [236, 62, 2], "howler monkey's head": [59, 90, 90], "howler monkey's body": [229, 91, 174], "howler monkey's hand": [80, 211, 62], "howler monkey's foot": [162, 4, 178], "howler monkey's tail": [166, 251, 56], "pop bottle's mouth": [196, 162, 68], "pop bottle's body": [113, 33, 205], "American black bear's head": [108, 118, 107], "American black bear's body": [252, 208, 254], "American black bear's foot": [87, 73, 182], "American black bear's tail": [231, 87, 96], "thunder snake's head": [196, 160, 16], "thunder snake's body": [117, 57, 3], "leopard's head": [228, 170, 218], "leopard's body": [75, 58, 144], "leopard's foot": [142, 253, 31], "leopard's tail": [156, 221, 163], "hartebeest's head": [150, 88, 51], "hartebeest's body": [145, 181, 26], "hartebeest's foot": [23, 155, 43], "hartebeest's tail": [55, 100, 129], "chimpanzee's head": [253, 238, 72], "chimpanzee's body": [179, 174, 176], "chimpanzee's hand": [71, 28, 21], "chimpanzee's foot": [159, 138, 165], "chimpanzee's tail": [219, 235, 214], "vizsla's head": [87, 78, 189], "vizsla's body": [70, 104, 19], "vizsla's foot": [133, 235, 129], "vizsla's tail": [48, 192, 149], "American egret's head": [86, 167, 255], "American egret's body": [168, 189, 112], "American egret's wing": [116, 166, 4], "American egret's foot": [192, 45, 107], "American egret's tail": [207, 247, 53], "Brittany spaniel's head": [204, 150, 246], "Brittany spaniel's body": [177, 237, 7], "Brittany spaniel's foot": [147, 169, 75], "Brittany spaniel's tail": [12, 3, 252], "goose's head": [14, 236, 158], "goose's body": [78, 166, 194], "goose's wing": [94, 182, 252], "goose's foot": [184, 192, 128], "goose's tail": [159, 117, 225], "water bottle's mouth": [194, 241, 23], "water bottle's body": [178, 131, 73], "proboscis monkey's head": [149, 95, 43], "proboscis monkey's body": [232, 139, 66], "proboscis monkey's hand": [233, 0, 19], "proboscis monkey's foot": [147, 252, 45], "proboscis monkey's tail": [146, 62, 12], "green snake's head": [35, 5, 104], "green snake's body": [234, 10, 24], "limousine's body": [52, 46, 251], "limousine's tier": [21, 16, 144], "limousine's side mirror": [146, 105, 157], "bullfrog's head": [167, 180, 226], "bullfrog's body": [56, 194, 36], "bullfrog's foot": [99, 56, 232], "bullfrog's tail": [11, 52, 253], "hognose snake's head": [25, 134, 137], "hognose snake's body": [242, 175, 245], "American alligator's head": [193, 220, 102], "American alligator's body": [110, 190, 89], "American alligator's foot": [34, 207, 44], "American alligator's tail": [154, 213, 81], "giant panda's head": [53, 60, 21], "giant panda's body": [250, 15, 175], "giant panda's foot": [250, 133, 3], "giant panda's tail": [1, 190, 172], "Boston bull's head": [181, 31, 195], "Boston bull's body": [119, 98, 150], "Boston bull's foot": [220, 56, 178], "Boston bull's tail": [25, 199, 7], "cougar's head": [152, 24, 245], "cougar's body": [139, 2, 146], "cougar's foot": [253, 186, 160], "cougar's tail": [227, 135, 85], "ram's head": [64, 240, 61], "ram's body": [166, 79, 25], "ram's foot": [69, 83, 97], "ram's tail": [147, 59, 71], "tench's head": [226, 68, 35], "tench's body": [248, 50, 67], "tench's fin": [78, 1, 140], "tench's tail": [7, 99, 115], "cairn's head": [152, 92, 54], "cairn's body": [26, 127, 240], "cairn's foot": [49, 75, 35], "cairn's tail": [37, 179, 17], "leatherback turtle's head": [56, 224, 238], "leatherback turtle's body": [14, 48, 222], "leatherback turtle's foot": [63, 78, 211], "leatherback turtle's tail": [118, 164, 27], "ruddy turnstone's head": [235, 104, 118], "ruddy turnstone's body": [90, 172, 254], "ruddy turnstone's wing": [247, 179, 45], "ruddy turnstone's foot": [200, 183, 150], "ruddy turnstone's tail": [44, 187, 160], "Arabian camel's head": [114, 136, 1], "Arabian camel's body": [215, 67, 62], "Arabian camel's foot": [27, 24, 65], "Arabian camel's tail": [150, 74, 249], "ice bear's head": [6, 109, 189], "ice bear's body": [100, 1, 209], "ice bear's foot": [207, 50, 98], "ice bear's tail": [147, 5, 24], "anemone fish's head": [72, 68, 175], "anemone fish's body": [237, 63, 84], "anemone fish's fin": [79, 17, 169], "anemone fish's tail": [29, 118, 116], "fox squirrel's head": [224, 82, 74], "fox squirrel's body": [254, 161, 23], "fox squirrel's foot": [110, 23, 96], "fox squirrel's tail": [249, 16, 169], "pirate's body": [141, 114, 8], "pirate's sail": [62, 38, 198], "spotted salamander's head": [215, 216, 77], "spotted salamander's body": [117, 99, 67], "spotted salamander's foot": [246, 236, 253], "spotted salamander's tail": [134, 32, 156], "recreational vehicle's body": [11, 77, 148], "recreational vehicle's tier": [66, 217, 135], "recreational vehicle's side mirror": [101, 117, 185], "sidewinder's head": [237, 171, 199], "sidewinder's body": [5, 186, 203], "box turtle's head": [9, 102, 185], "box turtle's body": [243, 11, 149], "box turtle's foot": [114, 137, 251], "box turtle's tail": [54, 217, 87], "Eskimo dog's head": [212, 242, 221], "Eskimo dog's body": [208, 26, 239], "Eskimo dog's foot": [211, 26, 204], "Eskimo dog's tail": [154, 147, 10], "Irish water spaniel's head": [247, 253, 140], "Irish water spaniel's body": [10, 211, 41], "Irish water spaniel's foot": [213, 81, 209], "Irish water spaniel's tail": [211, 162, 110], "tricycle's body": [240, 252, 118], "tricycle's head": [170, 63, 6], "tricycle's seat": [174, 242, 74], "tricycle's tier": [118, 74, 97], "tailed frog's head": [20, 29, 209], "tailed frog's body": [23, 198, 140], "tailed frog's foot": [121, 5, 193], "tailed frog's tail": [50, 115, 60], "African chameleon's head": [139, 123, 123], "African chameleon's body": [117, 83, 57], "African chameleon's foot": [227, 14, 154], "African chameleon's tail": [232, 207, 145], "spider monkey's head": [3, 78, 215], "spider monkey's body": [20, 2, 65], "spider monkey's hand": [163, 248, 37], "spider monkey's foot": [85, 145, 14], "spider monkey's tail": [18, 16, 129], "go-kart's body": [229, 218, 20], "go-kart's tier": [8, 168, 216], "go-kart's side mirror": [230, 62, 118], "Saluki's head": [8, 88, 144], "Saluki's body": [137, 223, 17], "Saluki's foot": [152, 114, 155], "Saluki's tail": [183, 255, 168], "baboon's head": [118, 167, 240], "baboon's body": [170, 6, 229], "baboon's hand": [193, 216, 54], "baboon's foot": [242, 102, 93], "baboon's tail": [49, 54, 65], "cab's body": [205, 100, 38], "cab's tier": [43, 127, 208], "cab's side mirror": [173, 52, 41], "Walker hound's head": [236, 216, 135], "Walker hound's body": [99, 48, 244], "Walker hound's foot": [106, 211, 239], "Walker hound's tail": [254, 190, 204], "tractor's body": [224, 228, 251], "tractor's tier": [192, 243, 16], "tractor's side mirror": [79, 5, 78], "cheetah's head": [65, 124, 140], "cheetah's body": [230, 46, 185], "cheetah's foot": [239, 253, 176], "cheetah's tail": [19, 46, 22], "whiptail's head": [78, 118, 0], "whiptail's body": [187, 177, 179], "whiptail's foot": [194, 71, 77], "whiptail's tail": [163, 64, 128], "Komodo dragon's head": [223, 129, 161], "Komodo dragon's body": [244, 41, 73], "Komodo dragon's foot": [162, 71, 237], "Komodo dragon's tail": [241, 21, 213], "bee eater's head": [242, 156, 72], "bee eater's body": [42, 201, 251], "bee eater's wing": [173, 30, 94], "bee eater's foot": [163, 79, 160], "bee eater's tail": [21, 194, 104], "Indian cobra's head": [56, 0, 119], "Indian cobra's body": [96, 254, 127], "kite's head": [46, 90, 218], "kite's body": [79, 26, 35], "kite's wing": [234, 147, 29], "kite's foot": [45, 163, 234], "kite's tail": [160, 139, 13], "alligator lizard's head": [88, 32, 187], "alligator lizard's body": [115, 6, 194], "alligator lizard's foot": [236, 91, 61], "alligator lizard's tail": [154, 43, 43], "gazelle's head": [221, 141, 189], "gazelle's body": [196, 161, 6], "gazelle's foot": [20, 4, 94], "gazelle's tail": [177, 152, 47], "agama's head": [164, 23, 253], "agama's body": [24, 121, 195], "agama's foot": [230, 96, 133], "agama's tail": [24, 174, 10], "mink's head": [84, 136, 6], "mink's body": [125, 93, 135], "mink's foot": [148, 85, 112], "mink's tail": [208, 1, 128], "horned viper's head": [128, 138, 178], "horned viper's body": [84, 140, 43], "diamondback's head": [171, 137, 38], "diamondback's body": [68, 202, 91], "colobus's head": [186, 115, 60], "colobus's body": [194, 91, 79], "colobus's hand": [225, 89, 201], "colobus's foot": [52, 49, 213], "colobus's tail": [157, 94, 240], "mountain bike's body": [230, 119, 92], "mountain bike's head": [220, 1, 150], "mountain bike's seat": [167, 56, 144], "mountain bike's tier": [18, 170, 72], "soft-coated wheaten terrier's head": [178, 161, 193], "soft-coated wheaten terrier's body": [228, 11, 206], "soft-coated wheaten terrier's foot": [185, 69, 130], "soft-coated wheaten terrier's tail": [136, 122, 114], "bighorn's head": [160, 26, 224], "bighorn's body": [77, 165, 174], "bighorn's foot": [55, 178, 161], "bighorn's tail": [18, 144, 68], "school bus's body": [94, 14, 106], "school bus's tier": [10, 110, 171], "school bus's side mirror": [212, 230, 227], "rock python's head": [194, 53, 165], "rock python's body": [7, 68, 94], "capuchin's head": [227, 165, 57], "capuchin's body": [22, 14, 235], "capuchin's hand": [181, 41, 211], "capuchin's foot": [99, 175, 45], "capuchin's tail": [182, 5, 146], "killer whale's head": [151, 200, 221], "killer whale's body": [128, 58, 71], "killer whale's fin": [180, 46, 92], "killer whale's tail": [111, 221, 26], "great white shark's head": [204, 195, 79], "great white shark's body": [45, 156, 97], "great white shark's fin": [221, 182, 234], "great white shark's tail": [5, 103, 236], "garter snake's head": [77, 80, 237], "garter snake's body": [153, 44, 146], "Saint Bernard's head": [59, 132, 0], "Saint Bernard's body": [98, 238, 138], "Saint Bernard's foot": [172, 171, 158], "Saint Bernard's tail": [237, 229, 195], "brown bear's head": [77, 28, 214], "brown bear's body": [69, 61, 82], "brown bear's foot": [99, 135, 64], "brown bear's tail": [230, 77, 239], "frilled lizard's head": [41, 9, 174], "frilled lizard's body": [40, 156, 174], "frilled lizard's foot": [121, 18, 97], "frilled lizard's tail": [36, 107, 92], "chow's head": [196, 203, 185], "chow's body": [106, 57, 117], "chow's foot": [7, 224, 90], "chow's tail": [206, 15, 146], "weasel's head": [12, 139, 157], "weasel's body": [29, 187, 229], "weasel's foot": [25, 74, 222], "weasel's tail": [36, 8, 161], "airliner's head": [179, 235, 15], "airliner's body": [67, 59, 222], "airliner's engine": [61, 253, 168], "airliner's wing": [80, 30, 228], "airliner's tail": [125, 1, 118], "bald eagle's head": [244, 221, 238], "bald eagle's body": [0, 172, 69], "bald eagle's wing": [241, 31, 132], "bald eagle's foot": [192, 48, 114], "bald eagle's tail": [107, 126, 110], "pill bottle's mouth": [103, 39, 10], "pill bottle's body": [95, 209, 131], "loggerhead's head": [100, 167, 50], "loggerhead's body": [210, 218, 41], "loggerhead's foot": [62, 218, 42], "loggerhead's tail": [171, 165, 92], "vine snake's head": [165, 166, 10], "vine snake's body": [84, 49, 26], "racer's body": [241, 203, 103], "racer's tier": [70, 162, 13], "racer's side mirror": [216, 32, 69], "marmoset's head": [204, 236, 112], "marmoset's body": [27, 216, 81], "marmoset's hand": [72, 252, 166], "marmoset's foot": [166, 104, 58], "marmoset's tail": [135, 152, 43]}
OBJ_CLASS_COLORS = {'school bus': [156, 151, 92], 'box turtle': [179, 94, 238], 'tench': [186, 66, 81], 'pirate': [192, 108, 156], 'garbage truck': [110, 148, 151], 'golden retriever': [3, 143, 33], 'killer whale': [156, 212, 81], 'bald eagle': [165, 83, 175], 'impala': [81, 106, 200], 'green lizard': [134, 18, 52], 'ambulance': [249, 10, 71], 'yawl': [182, 178, 9], 'Indian cobra': [200, 107, 254], 'albatross': [32, 63, 152], 'mountain bike': [213, 219, 32], 'goldfish': [175, 33, 10], 'ice bear': [135, 66, 200], 'beer bottle': [253, 171, 97], 'tiger': [169, 7, 1], 'green mamba': [44, 98, 42], 'leopard': [246, 79, 170], 'gazelle': [227, 1, 239], 'minibus': [222, 11, 139], 'barracouta': [137, 29, 116], 'gorilla': [151, 25, 252], 'motor scooter': [65, 168, 44], 'giant panda': [115, 74, 27], 'water bottle': [1, 64, 230], 'chimpanzee': [63, 61, 97], 'goose': [92, 86, 0], 'American alligator': [143, 87, 160], 'macaque': [245, 183, 238], 'bee eater': [47, 165, 12], 'racer': [79, 46, 33], 'hartebeest': [49, 176, 47], 'green snake': [5, 236, 179], 'chow': [219, 204, 28], 'patas': [37, 156, 227], 'thunder snake': [134, 161, 229], 'English springer': [4, 98, 205], 'Egyptian cat': [108, 140, 194], 'kite': [146, 157, 236], 'loggerhead': [6, 58, 184], 'minivan': [189, 46, 193], 'Saluki': [125, 216, 232], 'Eskimo dog': [163, 175, 198], 'agama': [232, 212, 79], 'anemone fish': [28, 143, 45], 'polecat': [238, 195, 176], 'coho': [43, 146, 175], 'guenon': [187, 204, 156], 'spider monkey': [243, 136, 192], 'timber wolf': [93, 169, 24], 'frilled lizard': [52, 202, 140], 'Irish water spaniel': [193, 176, 39], 'bighorn': [39, 160, 130], 'tricycle': [106, 8, 67], 'proboscis monkey': [143, 156, 217], 'African chameleon': [122, 12, 80], 'warthog': [93, 169, 138], 'vizsla': [186, 172, 87], 'police van': [247, 92, 98], 'Tibetan terrier': [118, 235, 107], 'sidewinder': [127, 44, 50], 'tractor': [88, 243, 171], 'horned viper': [235, 130, 242], 'American black bear': [162, 209, 245], 'rock python': [181, 120, 32], 'tailed frog': [153, 223, 197], 'fox squirrel': [212, 239, 125], 'cairn': [64, 173, 7], 'redbone': [230, 182, 198], 'American egret': [20, 35, 11], 'water buffalo': [150, 213, 45], 'leatherback turtle': [94, 146, 68], 'Walker hound': [91, 0, 83], 'garter snake': [21, 38, 202], 'golfcart': [11, 131, 162], 'ox': [74, 117, 118], 'go-kart': [149, 152, 84], 'convertible': [183, 198, 134], 'howler monkey': [43, 80, 207], 'cheetah': [2, 79, 247], 'ruddy turnstone': [192, 84, 92], 'pill bottle': [166, 20, 53], 'weasel': [3, 152, 86], 'Arabian camel': [64, 94, 143], 'airliner': [4, 12, 54], 'baboon': [42, 237, 7], 'spotted salamander': [127, 10, 110], 'recreational vehicle': [43, 110, 106], 'Brittany spaniel': [12, 236, 93], 'dowitcher': [47, 151, 163], 'capuchin': [254, 77, 39], 'hognose snake': [147, 141, 222], 'gibbon': [92, 2, 131], 'limousine': [94, 206, 2], 'colobus': [117, 173, 8], 'Gila monster': [34, 248, 76], 'night snake': [168, 162, 92], 'boa constrictor': [222, 128, 0], 'otter': [85, 152, 35], 'diamondback': [160, 54, 231], 'Boston bull': [210, 69, 87], 'common newt': [160, 171, 23], 'bullfrog': [186, 208, 169], 'black stork': [61, 53, 99], 'vine snake': [181, 155, 29], 'brown bear': [203, 186, 162], 'soft-coated wheaten terrier': [29, 78, 9], 'spoonbill': [102, 198, 125], 'snowplow': [245, 223, 121], 'ram': [128, 1, 16], 'Komodo dragon': [168, 204, 174], 'pop bottle': [148, 8, 237], 'Saint Bernard': [213, 59, 134], 'cab': [40, 154, 26], 'unicycle': [222, 96, 241], 'trimaran': [250, 130, 253], 'siamang': [55, 238, 155], 'little blue heron': [44, 110, 229], 'marmoset': [157, 111, 227], 'mink': [64, 231, 204], 'whiptail': [81, 0, 41], 'great white shark': [195, 255, 24], 'alligator lizard': [42, 72, 192], 'cougar': [215, 98, 59], 'beach wagon': [193, 126, 196]}
PART_CLASS_COLORS = {'body': [219, 80, 137], 'engine': [156, 117, 179], 'fin': [145, 192, 42], 'foot': [116, 138, 181], 'hand': [145, 44, 96], 'head': [218, 108, 251], 'mouth': [243, 219, 126], 'sail': [99, 216, 14], 'seat': [119, 189, 24], 'side mirror': [141, 40, 44], 'tail': [171, 43, 206], 'tier': [180, 28, 80], 'wing': [92, 234, 59]}


obj_map = {OBJ_CLASS_NAMES.index(c): i for i,c in enumerate(OBJ_BASE_CLASS_NAMES)}
obj_part_map = {CLASS_NAMES.index(c): i for i,c in enumerate(BASE_CLASS_NAMES)}

def _get_obj_part_meta(cat_list, obj_list):
    id_to_name = {i: c for i, c in enumerate(cat_list)}
    thing_dataset_id_to_contiguous_id = {i: i for i in range(len(cat_list))}
    return {
        # "thing_dataset_id_to_contiguous_id": thing_dataset_id_to_contiguous_id,
        # "stuff_dataset_id_to_contiguous_id": thing_dataset_id_to_contiguous_id,
        "stuff_classes": cat_list,
        "obj_classes": obj_list,
        "obj_base_classes": OBJ_BASE_CLASS_NAMES,
        "part_classes": PART_CLASS_NAMES,
        "part_base_classes": PART_BASE_CLASS_NAMES,
        "part_categories": PART_IN_CATEGORIES,
        "stuff_colors": [CLASS_COLORS[c] for c in cat_list],
        "obj_colors": [OBJ_CLASS_COLORS[c] for c in obj_list],
        "part_colors": [PART_CLASS_COLORS[c] for c in PART_CLASS_NAMES],
    }


_PART_IN = {
    "partimagenet_ood_obj_part_sem_seg_train": ("images/train", "train.json"),
    "partimagenet_ood_obj_part_sem_seg_val": ("images/val", "val.json"),
}


def load_json(_root, image_root, json_file, extra_annotation_keys=None, per_image=False, val_all=False, data_list=None):
    dataset_dicts = []
    obj_dataset_dicts = load_coco_json(os.path.join(_root, json_file), os.path.join(_root, image_root), extra_annotation_keys=extra_annotation_keys)
    if data_list is not None:
        img_list = json.load(open(data_list,'r'))
        img_list = [item["file_name"] for item in img_list]
    for dataset_dict in obj_dataset_dicts:
        if data_list is not None:
            if dataset_dict["file_name"] not in img_list:
                continue
        if not per_image:
            for anno in dataset_dict['annotations']:
                record = {}
                record['file_name'] = dataset_dict['file_name']
                record['height'] = dataset_dict['height']
                record['width'] = dataset_dict['width']
                record['obj_annotations'] = [anno]
                record["obj_sem_seg_file_name"] = 'NA'
                record['category_id'] = anno['category_id']
                record["sem_seg_file_name"] = dataset_dict['file_name'].replace('images','annotations').replace('JPEG','png')
                # if val_all and anno['category_id'] in obj_map:
                #     continue
                dataset_dicts.append(record)
        else:
            record = {}
            record['file_name'] = dataset_dict['file_name']
            record['height'] = dataset_dict['height']
            record['width'] = dataset_dict['width']
            record['obj_annotations'] = dataset_dict['annotations']
            record["obj_sem_seg_file_name"] = 'NA'
            # record['category_id'] = anno['category_id']
            record["sem_seg_file_name"] = dataset_dict['file_name'].replace('images','annotations').replace('JPEG','png')
            dataset_dicts.append(record)
    return dataset_dicts


def load_train_val_json(_root, image_root, val_json_file):
    val_dataset_dicts = load_json(_root, image_root, val_json_file)
    # train_dataset_dicts = load_json(_root, image_root.replace('val','train'), val_json_file.replace('val','train'), val_all=True)
    
    return val_dataset_dicts # + train_dataset_dicts


def register_partimagenet_ood(root):
    root = os.path.join(root, "PartImageNet_OOD")
    meta = _get_obj_part_meta(CLASS_NAMES, OBJ_CLASS_NAMES)
    base_meta = _get_obj_part_meta(BASE_CLASS_NAMES, OBJ_BASE_CLASS_NAMES)
    
    for name, (image_root, json_file) in _PART_IN.items():
        all_name = name
        name_obj_cond = all_name + "_obj_condition"

        MetadataCatalog.get(all_name).set(
            image_root=image_root,
            sem_seg_root=image_root,
            evaluator_type="sem_seg",
            ignore_label=65535,
            )

        if 'train' in name:
            DatasetCatalog.register(
                all_name, lambda: load_json(root, "images/train", "train.json", per_image=True)
            )
            DatasetCatalog.register(
                name_obj_cond, lambda: load_json(root, "images/train", "train.json")
            )
        else:
            # DatasetCatalog.register(
            #     all_name, lambda: load_json(root, "images/val", "val.json", per_image=True)
            # )
            DatasetCatalog.register(
                # name_obj_cond, lambda: load_train_val_json(root, "images/val", "val.json", per_image=True)
                name_obj_cond, lambda: load_json(root, "images/val", "val.json", per_image=True)
            ) ### test on both excusive train and val set
            
        if 'train' in name:
            MetadataCatalog.get(all_name).set(**base_meta)
            MetadataCatalog.get(all_name).set(obj_map=obj_map)
            MetadataCatalog.get(all_name).set(obj_part_map=obj_part_map)
        else:
            MetadataCatalog.get(all_name).set(**meta)

        MetadataCatalog.get(name_obj_cond).set(
            image_root=image_root,
            sem_seg_root=image_root,
            evaluator_type="sem_seg",
            ignore_label=65535,
        )
        MetadataCatalog.get(name_obj_cond).set(
            evaluation_set={
                "base": [
                    meta["stuff_classes"].index(n) for n in base_meta["stuff_classes"]
                ],
            },
            trainable_flag=[
                1 if n in base_meta["stuff_classes"] else 0
                for n in meta["stuff_classes"]
            ],
        )
        
        if name == 'train':
            MetadataCatalog.get(name_obj_cond).set(**base_meta)
            MetadataCatalog.get(name_obj_cond).set(obj_map=obj_map)
            MetadataCatalog.get(name_obj_cond).set(obj_part_map=obj_part_map)
        else:
            MetadataCatalog.get(name_obj_cond).set(**meta)

_root = os.getenv("DETECTRON2_DATASETS", "datasets")
register_partimagenet_ood(_root)